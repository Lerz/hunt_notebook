### **1. Executive Summary**
**Objective**: The objective of this hunt was to detect and mitigate potential exploitation of the **Log4Shell vulnerability CVE-2021-44228**, commonly exploited in Java-based applications using Apache Log4j for logging.

**Key Findings**:
- Multiple attempts to exploit Log4Shell via crafted requests were detected.
- Evidence of remote code execution attempts and malicious payload downloads were observed.

**Recommendations**:
- Apply security patches for Apache Log4j.
- Implement Web Application Firewall rules to block malicious payloads.
- Continue monitoring for suspicious behavior, particularly LDAP and JNDI calls.

### **2. Scope & Methodology**
**Timeframe**: The hunt covered logs and activities from the period when the Log4Shell vulnerability became widely known (December 2021 onwards).  
**Data Sources**: Web server logs, SIEM data, firewall logs, endpoint monitoring tools.  
**Hunt Focus**: Detecting indicators of compromise (IOCs) related to Log4Shell, specifically targeting Java-based web services and applications running vulnerable Log4j versions.

### **3. Hypotheses/Queries**
- Are there suspicious LDAP or JNDI calls in logs, indicating an exploitation attempt?
- Are there signs of remote payload execution triggered by the exploitation of Log4j?
```spl
index=web_logs
| search "jndi:ldap" OR "jndi:rmi" OR "jndi:dns"
| stats count by src_ip, dest_ip, uri_path, user_agent
| table _time, src_ip, dest_ip, uri_path, user_agent, count
```

### **4. Findings**
**Techniques identified**:
- **T1210 - Exploitation of Remote Services**: Detecting the execution of **remote code via malicious LDAP connections** exploiting Log4Shell.
- **T1078 - Valid Accounts**: Usage of compromised accounts to perform post-exploitation tasks after initial entry via Log4Shell.
  
**Indicators of compromise (IOCs)**:
- **LDAP/JNDI requests**: Detected malicious LDAP URL requests indicating the initiation of Log4Shell exploitation.
- **Java process activity**: Unusual Java processes (e.g., `java.exe`) attempting to connect to external IP addresses after log parsing.

**MITRE ATT&CK Mapping**:
- **T1190 - Exploitation of Public-Facing Applications**: Exploitation of vulnerable Log4j libraries through crafted web requests.
- **T1071 - Application Layer Protocol**: Malicious LDAP communications exploiting vulnerable services.

### **5. Mitigation & Response**
**Actions taken**:
- Blocked suspicious external LDAP connections at the firewall.
- Applied emergency patches to all vulnerable systems.
  
**Further recommendations**:
- Ensure all instances of Log4j are updated to a patched version (2.17.0+).
- Deploy an IDS/IPS that monitors for unusual Java execution.

**Elaborate analytics :**
- Monitor for suspicious LDAP/JNDI Requests:
```spl
index=web_logs OR index=application_logs
| search "jndi:ldap" OR "jndi:rmi" OR "jndi:dns"
| stats count by src_ip, dest_ip, uri_path, user_agent
| table _time, src_ip, dest_ip, uri_path, user_agent, count
```
- Monitor unusual java process activity :
```spl
index=os_logs sourcetype=process
| search process_name="java.exe" OR process_name="java"
| stats count by process_name, parent_process_name, dest_ip
| where dest_ip != "<internal_ips>"
| table _time, process_name, parent_process_name, dest_ip
```
- Check for known IOCs
```spl
index=network_traffic
| lookup log4shell_iocs.csv ip OUTPUT ip as matched_ip
| search matched_ip=*
| stats count by src_ip, dest_ip, uri_path
| table _time, src_ip, dest_ip, uri_path, count
```
- Monitor excessive HTTP/HTTPS 404 errors (indicating scanning activity):
```spl
index=web_logs status=404
| stats count by src_ip, uri_path
| where count > 10
| table _time, src_ip, uri_path, count
```
### **6. Conclusion**
The hunt successfully identified potential Log4Shell exploitation attempts through LDAP requests and Java process anomalies. Immediate patching and firewall rules were asked to mitigate the threat.

